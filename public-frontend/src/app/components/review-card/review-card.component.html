<mat-card class="review-card">
  <mat-card-header>
    <div class="header-content">
      <div class="user-info">
        <div class="avatar">
          <mat-icon>person</mat-icon>
        </div>
        <div class="user-details">
          <h3 class="user-name">{{ review().anonymous ? 'Anonymous' : review().userName }}</h3>
          <div class="meta-info">
            @if (review().semester !== undefined) {
              <span class="semester">{{ getSemesterText(review().semester!) }}</span>
              <span class="separator">•</span>
            }
            <span class="program-name">{{ review().studyProgramName || 'Computer Science' }}</span>
            @if (review().isEdited) {
              <span class="separator">•</span>
              <mat-chip class="edited-badge">
                <mat-icon>edit</mat-icon>
                Edited
              </mat-chip>
            }
          </div>        </div>
      </div>
      <div class="overall-rating" [style.color]="getRatingColor(review().rating)">
        <div class="rating-value">{{ review().rating }}</div>
        <div class="rating-label">Rating</div>
      </div>
    </div>
  </mat-card-header>

  <mat-card-content>
    <!-- Star rating display -->
    <div class="rating-stars-display">
      <div class="stars">
        @for (filled of getStarsArray(review().rating); track $index) {
          <mat-icon [class.filled]="filled">{{ filled ? 'star' : 'star_border' }}</mat-icon>
        }
      </div>
      <span class="rating-number">{{ review().rating }}/10</span>
    </div>

    <!-- Review text -->
    <div class="review-text">
      <p>{{ review().comment }}</p>
    </div>

    <!-- Footer -->
    <div class="review-footer">
      <div class="date-info">
        <mat-icon>schedule</mat-icon>
        <span>Posted {{ formatDate(review().createdAt) }}</span>
        @if (review().isEdited) {
          <span class="edited-date">(Updated {{ formatDate(review().updatedAt) }})</span>
        }
      </div>
      <button mat-button (click)="toggleComments()" class="comments-toggle">
        <mat-icon>comment</mat-icon>
        <span>{{ review().commentsCount }} {{ review().commentsCount === 1 ? 'Comment' : 'Comments' }}</span>
        <mat-icon class="expand-icon" [class.expanded]="isExpanded()">expand_more</mat-icon>
      </button>
    </div>
  </mat-card-content>

  <!-- Comments section (expandable) -->
  @if (isExpanded()) {
    <div class="comments-container">
      <app-comments-section [reviewId]="review().id" />
    </div>
  }
</mat-card>
