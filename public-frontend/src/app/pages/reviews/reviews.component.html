<div class="reviews-page">
  <div class="container">
    <!-- Program Details Header with Breadcrumb -->
    @if (isLoadingDetails()) {
      <div class="loading-header">
        <p>Loading program details...</p>
      </div>
    } @else if (programDetails()) {
      <app-program-details-header [programDetails]="programDetails()!" />
    }

    <!-- Write Review Button (only show if user is logged in and eligible) -->
    @if (authState.isLoggedIn() && canUserCreateReview()) {
      <div class="action-bar">
        <button mat-raised-button color="primary" (click)="toggleReviewForm()" class="write-review-btn">
          <mat-icon>{{ showReviewForm() ? 'close' : 'edit' }}</mat-icon>
          {{ showReviewForm() ? (editingReview() ? 'Cancel Edit' : 'Cancel') : (editingReview() ? 'Cancel Edit' : 'Write a Review') }}
        </button>
      </div>
    }

    <!-- Review Form (Conditional) -->
    @if (showReviewForm()) {
      <app-review-form
        [studyProgramId]="programDetails()?.id || 1"
        [editingReview]="editingReview()"
        (submitReview)="editingReview() ? onUpdateReview($event) : onSubmitReview($event)"
        (cancelForm)="onCancelReview()"
      />
    }

    <!-- Filter Section -->
    <app-review-filter (filterChange)="onFilterChange($event)" />

    <!-- Reviews List -->
    @if (isLoadingReviews()) {
      <div class="loading-reviews">
        <p>Loading reviews...</p>
      </div>
    } @else {
      @if (reviews().length === 0) {
        <div class="no-reviews">
          <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <h3>No Reviews Found</h3>
          <p>Be the first to write a review for this program!</p>
        </div>
      } @else {
        <div class="reviews-list">
          @for (review of reviews(); track review.id) {
            <app-review-card
              [review]="review"
              [showActions]="authState.isLoggedIn()"
              [currentUserId]="authState.userId()"
              (editReview)="onEditReview($event)"
              (deleteReview)="onDeleteReview($event)"
            />
          }
        </div>
      }
    }
  </div>
</div>
