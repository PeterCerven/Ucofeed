<div class="profile-container">
  <!-- Verification Card -->
  @if (showVerification()) {
    <mat-card class="verification-card">
      <mat-card-header class="verification-header">
        <mat-icon class="verification-icon">verified_user</mat-icon>
        <mat-card-title>Verify Your Account</mat-card-title>
        <mat-card-subtitle>Enter the verification code sent to your email to complete registration</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="verification-content">
        <form [formGroup]="verificationForm" class="verification-form">
          <!-- Email Field -->
          <mat-form-field class="full-width">
            <mat-label>Email</mat-label>
            <mat-icon matPrefix>email</mat-icon>
            <input
              matInput
              type="email"
              formControlName="email"
              placeholder="your.email@university.sk"
              autocomplete="email"
              readonly
            />
            @if (verificationForm.get('email')?.touched) {
              <mat-error>
                {{ getVerificationErrorMessage('email') }}
              </mat-error>
            }
          </mat-form-field>

          <!-- Verification Code Field -->
          <mat-form-field class="full-width">
            <mat-label>Verification Code</mat-label>
            <mat-icon matPrefix>pin</mat-icon>
            <input
              matInput
              type="text"
              formControlName="verificationCode"
              placeholder="Enter the code from your email"
              autocomplete="off"
            />
            <mat-hint>Enter the 6-digit code sent to your email</mat-hint>
            @if (verificationForm.get('verificationCode')?.touched) {
              <mat-error>
                {{ getVerificationErrorMessage('verificationCode') }}
              </mat-error>
            }
          </mat-form-field>
        </form>
      </mat-card-content>

      <mat-card-actions class="verification-actions">
        <button
          mat-flat-button
          color="primary"
          type="submit"
          (click)="onVerify()"
          class="verify-button"
          [disabled]="verificationForm.invalid || isVerifying()"
        >
          @if (isVerifying()) {
            <mat-icon>hourglass_empty</mat-icon>
            <span>Verifying...</span>
          } @else {
            <mat-icon>check_circle</mat-icon>
            <span>Verify Account</span>
          }
        </button>
      </mat-card-actions>
    </mat-card>
  }

  <!-- Profile Card -->
  <mat-card class="profile-card">
    <mat-card-header class="profile-header">
      <mat-icon class="profile-icon">account_circle</mat-icon>
      <mat-card-title>My Profile</mat-card-title>
      <mat-card-subtitle>Manage your academic information</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="profile-content">
      <form [formGroup]="profileForm" class="profile-form">

        <!-- University Selection -->
        <mat-form-field class="full-width">
          <mat-label>University</mat-label>
          <mat-icon matPrefix>school</mat-icon>
          <mat-select formControlName="universityId" placeholder="Select your university">
            @for (university of universities(); track university.id) {
              <mat-option [value]="university.id">{{ university.name }}</mat-option>
            }
          </mat-select>
          <mat-hint>Select your university</mat-hint>
        </mat-form-field>

        <!-- Faculty Selection -->
        <mat-form-field class="full-width">
          <mat-label>Faculty</mat-label>
          <mat-icon matPrefix>domain</mat-icon>
          <mat-select
            formControlName="facultyId"
            placeholder="Select your faculty"
            [disabled]="!profileForm.get('universityId')?.value"
          >
            @for (faculty of faculties(); track faculty.id) {
              <mat-option [value]="faculty.id">{{ faculty.name }}</mat-option>
            }
          </mat-select>
          <mat-hint>Select your faculty (choose university first)</mat-hint>
        </mat-form-field>

        <!-- Study Programme Selection -->
        <mat-form-field class="full-width">
          <mat-label>Study Programme</mat-label>
          <mat-icon matPrefix>menu_book</mat-icon>
          <mat-select
            formControlName="studyProgramId"
            placeholder="Select your study programme"
            [disabled]="!profileForm.get('facultyId')?.value"
          >
            @for (program of programs(); track program.id) {
              <mat-option [value]="program.id">{{ program.name }}</mat-option>
            }
          </mat-select>
          <mat-hint>Select your study programme (choose faculty first)</mat-hint>
        </mat-form-field>

        <!-- Study Programme Variant -->
        <mat-form-field class="full-width">
          <mat-label>Study Variant</mat-label>
          <mat-icon matPrefix>tune</mat-icon>
          <mat-select
            formControlName="studyProgramVariantId"
            placeholder="Select study variant"
            [disabled]="!profileForm.get('studyProgramId')?.value"
          >
            @for (variant of variants(); track variant.id) {
              <mat-option [value]="variant.id">
                {{ variant.language }} - {{ variant.study_form }} - {{ variant.title }}
              </mat-option>
            }
          </mat-select>
          <mat-hint>Select your study variant (choose programme first)</mat-hint>
          @if (profileForm.get('studyProgramVariantId')?.touched) {
            <mat-error>
              {{ getErrorMessage('studyProgramVariantId') }}
            </mat-error>
          }
        </mat-form-field>

        <!-- Status -->
        <mat-form-field class="full-width">
          <mat-label>Status</mat-label>
          <mat-icon matPrefix>assignment_ind</mat-icon>
          <mat-select formControlName="status" placeholder="Select your status">
            @for (status of statuses; track status.value) {
              <mat-option [value]="status.value">{{ status.label }}</mat-option>
            }
          </mat-select>
          @if (profileForm.get('status')?.touched) {
            <mat-error>
              {{ getErrorMessage('status') }}
            </mat-error>
          }
        </mat-form-field>

      </form>
    </mat-card-content>

    <mat-card-actions class="profile-actions">
      <button
        mat-stroked-button
        type="button"
        (click)="onReset()"
        class="reset-button"
      >
        <mat-icon>refresh</mat-icon>
        <span>Reset</span>
      </button>
      <button
        mat-flat-button
        color="primary"
        type="submit"
        (click)="onSave()"
        class="save-button"
        [disabled]="profileForm.invalid"
      >
        <mat-icon>save</mat-icon>
        <span>Save Profile</span>
      </button>
    </mat-card-actions>
  </mat-card>
</div>
