<div class="profile-container" *transloco="let t; prefix 'pages.profile'">
  <!-- Verification Card -->
  @if (showVerification()) {
    <mat-card class="verification-card">
      <mat-card-header class="verification-header">
        <mat-icon class="verification-icon">verified_user</mat-icon>
        <mat-card-title>{{ t('titles.verifyAccount') }}</mat-card-title>
        <mat-card-subtitle>{{ t('subtitles.verifyRegistration') }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content class="verification-content">
        <form [formGroup]="verificationForm" class="verification-form">
          <!-- Email Field -->
          <mat-form-field class="full-width">
            <mat-label>{{ t('fields.email') }}</mat-label>
            <mat-icon matPrefix>email</mat-icon>
            <input
              matInput
              type="email"
              formControlName="email"
              [placeholder]="t('placeholders.emailUniversity')"
              autocomplete="email"
              readonly
            />
            @if (verificationForm.get('email')?.touched) {
              <mat-error>
                {{ getVerificationErrorMessage('email') }}
              </mat-error>
            }
          </mat-form-field>

          <!-- Verification Code Field -->
          <mat-form-field class="full-width">
            <mat-label>{{ t('fields.verificationCode') }}</mat-label>
            <mat-icon matPrefix>pin</mat-icon>
            <input
              matInput
              type="text"
              formControlName="verificationCode"
              [placeholder]="t('placeholders.verificationCode')"
              autocomplete="off"
            />
            <mat-hint>{{ t('hints.verificationCodeDigits') }}</mat-hint>
            @if (verificationForm.get('verificationCode')?.touched) {
              <mat-error>
                {{ getVerificationErrorMessage('verificationCode') }}
              </mat-error>
            }
          </mat-form-field>
        </form>
      </mat-card-content>

      <mat-card-actions class="verification-actions">
        <button
          mat-flat-button
          color="primary"
          type="submit"
          (click)="onVerify()"
          class="verify-button"
          [disabled]="verificationForm.invalid || isVerifying()"
        >
          @if (isVerifying()) {
            <ng-container>
              <mat-icon>hourglass_empty</mat-icon>
              <span>{{ t('verifying') }}</span>
            </ng-container>
          } @else {
            <ng-container>
              <mat-icon>check_circle</mat-icon>
              <span>{{ t('actions.verifyAccount') }}</span>
            </ng-container>
          }
        </button>
      </mat-card-actions>
    </mat-card>
  }

  <!-- Profile Card -->
  <mat-card class="profile-card">
    <mat-card-header class="profile-header">
      <mat-icon class="profile-icon">account_circle</mat-icon>
      <mat-card-title>{{ t('titles.myProfile') }}</mat-card-title>
      <mat-card-subtitle>{{ t('subtitles.manageInfo') }}</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="profile-content">
      <form [formGroup]="profileForm" class="profile-form">

        <!-- University Display (Read-only) -->
        <mat-form-field class="full-width">
          <mat-label>{{ t('fields.university') }}</mat-label>
          <mat-icon matPrefix>school</mat-icon>
          <input
            matInput
            [value]="university()?.name || t('loading')"
            readonly
            disabled
          />
          <mat-hint>{{ t('hints.emailAutoDetected') }}</mat-hint>
        </mat-form-field>

        <!-- Faculty Selection -->
        <mat-form-field class="full-width">
          <mat-label>{{ t('fields.faculty') }}</mat-label>
          <mat-icon matPrefix>domain</mat-icon>
          <mat-select
            formControlName="facultyId"
            [placeholder]="t('placeholders.faculty')"
            [disabled]="!profileForm.get('universityId')?.value"
          >
            @for (faculty of faculties(); track faculty.id) {
              <mat-option [value]="faculty.id">{{ faculty.name }}</mat-option>
            }
          </mat-select>
          <mat-hint>{{ t('hints.facultySelect') }}</mat-hint>
        </mat-form-field>

        <!-- Study Programme Selection -->
        <mat-form-field class="full-width">
          <mat-label>{{ t('fields.studyProgramme') }}</mat-label>
          <mat-icon matPrefix>menu_book</mat-icon>
          <mat-select
            formControlName="studyProgramId"
            [placeholder]="t('placeholders.programmeSelect')"
            [disabled]="!profileForm.get('facultyId')?.value"
          >
            @for (program of programs(); track program.id) {
              <mat-option [value]="program.id">{{ program.name }}</mat-option>
            }
          </mat-select>
          <mat-hint>{{ t('hints.programmeSelectFacultyFirst') }}</mat-hint>
        </mat-form-field>

        <!-- Study Programme Variant -->
        <mat-form-field class="full-width">
          <mat-label>{{ t('fields.studyVariant') }}</mat-label>
          <mat-icon matPrefix>tune</mat-icon>
          <mat-select
            formControlName="studyProgramVariantId"
            [placeholder]="t('placeholders.variantSelect')"
            [disabled]="!profileForm.get('studyProgramId')?.value"
          >
            @for (variant of variants(); track variant.id) {
              <mat-option [value]="variant.id">
                {{ variant.language }} - {{ variant.study_form }} - {{ variant.title }}
              </mat-option>
            }
          </mat-select>
          <mat-hint>{{ t('hints.variantSelectProgrammeFirst') }}</mat-hint>
          @if (profileForm.get('studyProgramVariantId')?.touched) {
            <mat-error>
              {{ getErrorMessage('studyProgramVariantId') }}
            </mat-error>
          }
        </mat-form-field>

        <!-- Status -->
        <mat-form-field class="full-width">
          <mat-label>{{ t('fields.status') }}</mat-label>
          <mat-icon matPrefix>assignment_ind</mat-icon>
          <mat-select formControlName="status" [placeholder]="t('placeholders.status')">
            @for (status of statuses; track status.value) {
              <mat-option [value]="status.value">{{ status.label | transloco }}</mat-option>
            }
          </mat-select>
          @if (profileForm.get('status')?.touched) {
            <mat-error>
              {{ getErrorMessage('status') }}
            </mat-error>
          }
        </mat-form-field>

      </form>
    </mat-card-content>

    <mat-card-actions class="profile-actions">
      <button
        mat-stroked-button
        type="button"
        (click)="onReset()"
        class="reset-button"
      >
        <mat-icon>refresh</mat-icon>
        <span>{{ t('actions.reset') }}</span>
      </button>
      <button
        mat-flat-button
        color="primary"
        type="submit"
        (click)="onSave()"
        class="save-button"
        [disabled]="profileForm.invalid"
      >
        <mat-icon>save</mat-icon>
        <span>{{ t('actions.saveProfile') }}</span>
      </button>
    </mat-card-actions>
  </mat-card>
</div>
